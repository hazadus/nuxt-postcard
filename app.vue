<script setup lang="ts">

interface IFields {
  backgroundURL: string
  profileURL: string
  title: string
  siteURL: string
}

const previewUrl: Ref<string | null>= ref(null);

async function createCard(fields: IFields) {
  // const apiBase = "http://127.0.0.1:8000";
  // const apiBase = "http://92.255.109.128:8008";
  const apiBase = "https://postcard.hazadus.ru";

  const url = `${apiBase}/v1/card?title=${encodeURIComponent(fields.title)}` 
  + `&url=${encodeURIComponent(fields.siteURL)}`
  + `&profileURL=${encodeURIComponent(fields.profileURL)}`
  + `&backgroundURL=${encodeURIComponent(fields.backgroundURL)}`

  previewUrl.value = url;
}
</script>

<template>
  <Title>Postcard ‚Äì –≥–µ–Ω–µ—Ä–∞—Ü–∏—è social preview cards</Title>
  <div class="bg-white rounded-xl shadow-xl p-8 mx-auto my-2 max-w-[600px]">
    <h1 class="text-4xl mb-6">üåÖ Postcard</h1>
    <FormKit
      type="form"
      #default="{ value }"
      @submit="createCard"
      submit-label="–°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É"
    >
      <FormKit
        <FormKit
        type="url"
        name="backgroundURL"
        label="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ–Ω–∞"
        help="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ñ–æ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏"
        placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É"
        validation="required"
      />
      <FormKit
        <FormKit
        type="url"
        name="profileURL"
        label="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è"
        help="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è —Ñ–æ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏"
        placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É"
        validation="required"
      />
      <FormKit
        <FormKit
        type="text"
        name="title"
        label="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏"
        help="–≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –∫—Ä—É–ø–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º"
        placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞"
        validation="required"
      />
      <FormKit
        <FormKit
        type="url"
        name="siteURL"
        label="–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç"
        help="–≠—Ç–∞ —Å—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç –≤ –ª–µ–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É –∫–∞—Ä—Ç–æ—á–∫–∏"
        placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É"
        validation="required"
      />

      <!-- <pre class="font-mono text-sm p-4 bg-slate-100 mb-4">{{ value }}</pre> -->

      <template v-if="previewUrl">
        <img :src="previewUrl" class="mb-2">
        <textarea class="w-full mb-2">{{ previewUrl }}</textarea>
      </template>
    </FormKit>
  </div>
</template>
